{% extends "base.html" %}

{% block title %}Hacker News Report - Home{% endblock %}

{% block content %}
<div class="sidebar">
    <h2>Categories</h2>
    <div class="category-list">
        <a href="/" class="category-item {% if current_category == 'all' %}active{% endif %}">
            <span class="category-name">All Posts</span>
            <span class="category-count">{{ stats.values()|sum if stats else 0 }}</span>
        </a>
        <a href="/?category=story" class="category-item {% if current_category == 'story' %}active{% endif %}">
            <span class="category-name">üìñ Stories</span>
            <span class="category-count">{{ stats.get('story', 0) }}</span>
        </a>
        <a href="/?category=job" class="category-item {% if current_category == 'job' %}active{% endif %}">
            <span class="category-name">üíº Jobs</span>
            <span class="category-count">{{ stats.get('job', 0) }}</span>
        </a>
        <a href="/?category=ask" class="category-item {% if current_category == 'ask' %}active{% endif %}">
            <span class="category-name">‚ùì Ask HN</span>
            <span class="category-count">{{ stats.get('ask', 0) }}</span>
        </a>
        <a href="/?category=poll" class="category-item {% if current_category == 'poll' %}active{% endif %}">
            <span class="category-name">üìä Polls</span>
            <span class="category-count">{{ stats.get('poll', 0) }}</span>
        </a>
        <a href="/?category=other" class="category-item {% if current_category == 'other' %}active{% endif %}">
            <span class="category-name">üìù Other</span>
            <span class="category-count">{{ stats.get('other', 0) }}</span>
        </a>
    </div>

    {% if tag_stats %}
    <h2 style="margin-top: 30px;">Popular Tags</h2>
    <div class="tag-cloud">
        {% for tag, count in tag_stats.items()[:15] %}
        <a href="/?tag={{ tag }}" class="tag-item {% if current_tag == tag %}active{% endif %}">
            {{ tag }} <span class="tag-count">({{ count }})</span>
        </a>
        {% endfor %}
    </div>
    {% endif %}
</div>

<div class="main-content">
    <div class="header-section">
        <h2>
            {% if current_category == 'all' %}
                All Posts
            {% elif current_category == 'story' %}
                Stories
            {% elif current_category == 'job' %}
                Job Postings
            {% elif current_category == 'ask' %}
                Ask HN
            {% elif current_category == 'poll' %}
                Polls
            {% else %}
                Other Posts
            {% endif %}
        </h2>
        <p class="post-count">{{ posts|length }} posts</p>
    </div>

    {% if posts %}
        <div class="posts-list">
            {% for post in posts %}
            <article class="post-card">
                <div class="post-header">
                    <h3 class="post-title">
                        {% if post.url %}
                            <a href="{{ post.url }}" target="_blank" rel="noopener">{{ post.title }}</a>
                            <span class="external-link">‚Üó</span>
                        {% else %}
                            <a href="/post/{{ post.id }}">{{ post.title }}</a>
                        {% endif %}
                    </h3>
                    <span class="post-category category-{{ post.category.value }}">{{ post.category.value }}</span>
                </div>
                
                <div class="post-meta">
                    <span class="post-score">‚¨Ü {{ post.score }} points</span>
                    <span class="post-author">by {{ post.author }}</span>
                    <span class="post-date">{{ post.created_at|timestamp_to_date }}</span>
                </div>
                
                {% if post.tags %}
                <div class="post-tags">
                    {% for tag in post.tags %}
                    <a href="/?tag={{ tag }}" class="post-tag">{{ tag }}</a>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% if post.url %}
                <div class="post-url">
                    <a href="{{ post.url }}" target="_blank" rel="noopener">{{ post.url|truncate(60) }}</a>
                </div>
                {% endif %}
            </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>No posts found</h3>
            <p>Try fetching posts using the CLI:</p>
            <code>python -m src fetch --limit 30</code>
        </div>
    {% endif %}
</div>
{% endblock %}
